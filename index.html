<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Beautifier Online - Format & Rapikan JSON Instan</title>
    <meta name="description" content="JSON Beautifier gratis dan online untuk merapikan file JSON. Cukup paste dan klik Beautify! Mendukung upload file dan drag & drop.">
    <meta name="robots" content="index, follow">

    <!-- Favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Tailwind Configuration for Dark Theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary-purple': '#5B21B6', // Purple-800
                        'dark-green': '#14532D', // Green-900
                        'light-purple': '#C4B5FD', // Purple-300
                        'accent-green': '#34D399', // Green-500
                        'bg-dark': '#1F2937', // Dark Gray-800 for general background
                        'input-bg': '#374151', // Dark Gray-700 for textareas
                        'error-red': '#EF4444', // Red-500
                    }
                }
            }
        }
    </script>

    <!-- Schema.org SoftwareApplication Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SoftwareApplication",
        "name": "JSON Beautifier Online",
        "operatingSystem": "Web",
        "applicationCategory": "DeveloperApplication",
        "description": "Beautify and format JSON instantly in your browser. Paste, upload, or download clean JSON output.",
        "url": "https://jsonbeautifier.vinnesia.my.id",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        }
    }
    </script>

    <!-- Open Graph Tags for SEO -->
    <meta property="og:title" content="JSON Beautifier Online - Format & Rapikan JSON Instan">
    <meta property="og:description" content="JSON Beautifier gratis dan online untuk merapikan file JSON. Cukup paste dan klik Beautify! Mendukung upload file dan drag & drop.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://jsonbeautifier.vinnesia.my.id">
    <meta property="og:image" content="https://jsonbeautifier.vinnesia.my.id/logo.png"> <!-- Pastikan path ini benar -->
    <meta property="og:image:alt" content="VIN NESIA JSON BEAUTIFIER Logo">

    <!-- Google Analytics GA4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3PYZXZFNER"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-3PYZXZFNER');
    </script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* Gradient background from purple to dark green */
            background: linear-gradient(to bottom right, #5B21B6, #14532D);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #E5E7EB; /* Light gray text */
        }
        .container {
            flex-grow: 1;
        }
        textarea {
            resize: vertical; /* Allow vertical resizing */
            min-height: 200px; /* Minimum height for textareas */
        }
        .btn {
            @apply px-6 py-3 rounded-lg font-semibold transition duration-300 ease-in-out transform hover:scale-105 shadow-lg;
        }
        .btn-primary {
            @apply bg-primary-purple text-white hover:bg-purple-700;
        }
        .btn-secondary {
            @apply bg-accent-green text-white hover:bg-green-600;
        }
        .btn-tertiary {
            @apply bg-gray-600 text-white hover:bg-gray-700;
        }
        /* New style for the upload button area */
        .upload-button-area {
            @apply flex items-center justify-center py-3 px-6 rounded-lg font-semibold text-white cursor-pointer;
            background: linear-gradient(to right, #6D28D9, #3B82F6); /* Purple-700 to Blue-500 */
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .upload-button-area:hover {
            @apply shadow-xl transform scale-105;
        }
    </style>
</head>
<body class="font-sans">
    <header class="bg-bg-dark text-white p-4 shadow-md">
        <div class="max-w-7xl mx-auto flex flex-col sm:flex-row items-center justify-between">
            <div class="flex items-center mb-4 sm:mb-0">
                <img src="logo.png" alt="VIN NESIA Logo" class="h-10 w-10 mr-3 rounded-full">
                <h1 class="text-2xl font-bold text-light-purple">VIN NESIA JSON BEAUTIFIER</h1>
            </div>
            <nav>
                <a href="https://www.vinnesia.my.id" class="btn btn-tertiary text-sm sm:text-base">🔙 Kembali ke Homepage</a>
            </nav>
        </div>
    </header>

    <main class="container max-w-7xl mx-auto p-6 my-8 bg-bg-dark rounded-xl shadow-2xl">
        <h1 class="text-4xl font-extrabold text-center mb-8 text-white">JSON Beautifier Online</h1>

        <!-- Input Section -->
        <div class="mb-6">
            <label for="jsonInput" class="block text-lg font-medium text-gray-200 mb-2">Paste JSON Mentah di Sini:</label>
            <textarea id="jsonInput" class="w-full p-4 rounded-lg bg-input-bg text-gray-100 border border-gray-600 focus:ring-2 focus:ring-primary-purple focus:border-transparent outline-none" placeholder="Contoh: {'name':'John','age':30,'city':'New York'}" spellcheck="false"></textarea>
        </div>

        <!-- File Upload Section -->
        <div class="mb-6">
            <label for="fileInput" class="block text-lg font-medium text-gray-200 mb-2">Atau Unggah File:</label>
            <div id="dropArea" class="upload-button-area">
                <span class="text-xl mr-2">📂</span> <!-- Folder icon emoji -->
                <span>Upload File JSON</span>
            </div>
            <p class="text-sm text-gray-400 mt-2 text-center">Seret & Lepas file di sini, atau klik tombol di atas.</p>
            <p class="text-sm text-gray-400 mt-1 text-center">Kami menerima semua file teks (termasuk .zip, .rar, .tar). Isi file akan dicek apakah valid JSON.</p>
            <input type="file" id="fileInput" class="hidden" multiple accept="*/*"> <!-- Accept all file types -->
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
            <button id="beautifyBtn" class="btn btn-primary">Beautify JSON</button>
            <button id="clearBtn" class="btn btn-tertiary">Bersihkan</button>
        </div>

        <!-- Error Message Display -->
        <div id="errorMessage" class="hidden bg-error-red text-white p-3 rounded-lg mb-6 text-center font-medium">
            <!-- Error message will be displayed here -->
        </div>

        <!-- Output Section -->
        <div class="mb-6">
            <label for="jsonOutput" class="block text-lg font-medium text-gray-200 mb-2">Hasil JSON yang Dirapikan:</label>
            <textarea id="jsonOutput" class="w-full p-4 rounded-lg bg-input-bg text-gray-100 border border-gray-600 focus:ring-2 focus:ring-primary-purple focus:border-transparent outline-none" readonly spellcheck="false"></textarea>
        </div>

        <!-- Output Action Buttons -->
        <div class="flex flex-col sm:flex-row justify-center gap-4">
            <button id="copyBtn" class="btn btn-secondary">Salin ke Clipboard</button>
            <button id="downloadBtn" class="btn btn-secondary">Unduh sebagai JSON</button>
        </div>
    </main>

    <footer class="bg-bg-dark text-gray-400 text-center p-4 mt-8 shadow-inner">
        <div class="max-w-7xl mx-auto">
            <p class="mb-2">&copy;2025 vinnesia.my.id — All Rights Reserved</p>
            <a href="privacy.html" class="text-primary-purple hover:underline">Kebijakan Privasi</a>
        </div>
    </footer>

    <!-- fflate.js for ZIP handling -->
    <script src="https://unpkg.com/fflate@0.8.0/umd/index.js"></script>

    <script>
        const jsonInput = document.getElementById('jsonInput');
        const jsonOutput = document.getElementById('jsonOutput');
        const beautifyBtn = document.getElementById('beautifyBtn');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const clearBtn = document.getElementById('clearBtn');
        const fileInput = document.getElementById('fileInput');
        const dropArea = document.getElementById('dropArea');
        const errorMessage = document.getElementById('errorMessage');

        /**
         * Menampilkan pesan error dan menyembunyikannya setelah beberapa detik.
         * @param {string} message - Pesan error yang akan ditampilkan.
         */
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000); // Sembunyikan setelah 5 detik
        }

        /**
         * Memeriksa apakah string adalah JSON yang valid.
         * @param {string} str - String yang akan diperiksa.
         * @returns {boolean} - True jika valid JSON, false jika tidak.
         */
        function isValidJson(str) {
            try {
                JSON.parse(str);
            } catch (e) {
                return false;
            }
            return true;
        }

        /**
         * Merapikan JSON dari input textarea ke output textarea.
         */
        function beautifyJson() {
            const rawJson = jsonInput.value.trim();
            if (!rawJson) {
                jsonOutput.value = '';
                showError('Input JSON kosong. Silakan paste JSON atau unggah file.');
                return;
            }

            try {
                const parsedJson = JSON.parse(rawJson);
                // Use 2 spaces for indentation
                jsonOutput.value = JSON.stringify(parsedJson, null, 2);
                errorMessage.classList.add('hidden'); // Hide any previous error
            } catch (e) {
                jsonOutput.value = '';
                showError('❌ JSON tidak valid! Silakan periksa sintaksnya.');
            }
        }

        /**
         * Menyalin konten dari output textarea ke clipboard.
         */
        function copyToClipboard() {
            jsonOutput.select();
            jsonOutput.setSelectionRange(0, 99999); // For mobile devices
            try {
                document.execCommand('copy');
                // In a real application, consider a custom modal instead of alert()
                // For this context, alert() is used for simplicity.
                alert('JSON berhasil disalin ke clipboard!');
            } catch (err) {
                showError('Gagal menyalin ke clipboard. Browser Anda mungkin tidak mendukung fitur ini.');
            }
        }

        /**
         * Mengunduh konten dari output textarea sebagai file JSON.
         */
        function downloadJson() {
            const beautifiedJson = jsonOutput.value;
            if (!beautifiedJson) {
                showError('Tidak ada JSON untuk diunduh. Silakan beautify JSON terlebih dahulu.');
                return;
            }

            const blob = new Blob([beautifiedJson], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'beautified.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        /**
         * Membersihkan input dan output textarea.
         */
        function clearTextareas() {
            jsonInput.value = '';
            jsonOutput.value = '';
            errorMessage.classList.add('hidden');
        }

        /**
         * Memproses konten teks dan mencoba mem-parse sebagai JSON.
         * Jika berhasil, akan mengisi input dan meng-beautify.
         * @param {string} content - Konten teks dari file.
         * @param {string} fileName - Nama file (untuk pesan error).
         * @returns {boolean} - True jika JSON valid ditemukan dan diproses, false jika tidak.
         */
        function processTextContent(content, fileName) {
            if (isValidJson(content)) {
                jsonInput.value = content;
                beautifyJson();
                return true;
            } else {
                return false;
            }
        }

        /**
         * Memproses file yang diunggah atau di-drag.
         * Mencari JSON valid di dalam file, termasuk di dalam arsip ZIP.
         * @param {FileList} files - Objek FileList dari event.
         */
        async function processFiles(files) {
            if (files.length === 0) return;

            errorMessage.classList.add('hidden'); // Sembunyikan pesan error sebelumnya
            jsonInput.value = ''; // Bersihkan input
            jsonOutput.value = ''; // Bersihkan output

            let jsonFoundInAnyFile = false;

            for (const file of files) {
                const fileName = file.name.toLowerCase();

                // Handle ZIP files using fflate.js
                if (fileName.endsWith('.zip')) {
                    try {
                        const buffer = await file.arrayBuffer();
                        const unzipped = fflate.unzipSync(new Uint8Array(buffer)); // Synchronous unzip

                        let jsonFoundInZip = false;
                        for (const entryName in unzipped) {
                            const data = unzipped[entryName];
                            // Check if it's a file (not a directory) and has content
                            if (data instanceof Uint8Array && data.length > 0) {
                                const textDecoder = new TextDecoder('utf-8');
                                const content = textDecoder.decode(data);
                                if (processTextContent(content, entryName)) {
                                    jsonFoundInZip = true;
                                    jsonFoundInAnyFile = true;
                                    break; // Stop after finding the first valid JSON in the ZIP
                                }
                            }
                        }
                        if (jsonFoundInZip) {
                            break; // Stop processing further files if JSON found in this ZIP
                        } else {
                            showError(`❌ Tidak ditemukan file berisi JSON valid di dalam arsip "${file.name}".`);
                        }
                    } catch (e) {
                        console.error('Error processing ZIP file:', e);
                        showError(`❌ Gagal membaca file arsip "${file.name}".`);
                    }
                }
                // Handle other files (including .rar, .tar, .txt, .log, images, etc. as plain text)
                else {
                    await new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const content = e.target.result;
                            if (processTextContent(content, file.name)) {
                                jsonFoundInAnyFile = true;
                            } else {
                                showError(`❌ Isi file "${file.name}" tidak valid JSON!`);
                            }
                            resolve(); // Resolve the promise to continue loop
                        };
                        reader.onerror = () => {
                            showError(`❌ Gagal membaca file "${file.name}".`);
                            resolve();
                        };
                        // Read as text, regardless of actual file type
                        reader.readAsText(file);
                    });

                    if (jsonFoundInAnyFile) {
                        break; // Stop processing further files if JSON found in this file
                    }
                }
            }

            // If after processing all files, no valid JSON was found
            if (!jsonFoundInAnyFile && files.length > 0) {
                 // This specific error is handled by processTextContent or ZIP error.
                 // This block is mostly for when multiple files are dropped and none are valid.
                 // The individual file errors will likely overwrite each other,
                 // so a final general error might be useful if nothing was found.
                 // Let's rely on the specific errors from processTextContent for now.
                 // If the last processed file was invalid, its error will be shown.
                 // If a ZIP was processed and no JSON found, its error will be shown.
            }
        }

        // Event Listeners
        beautifyBtn.addEventListener('click', beautifyJson);
        copyBtn.addEventListener('click', copyToClipboard);
        downloadBtn.addEventListener('click', downloadJson);
        clearBtn.addEventListener('click', clearTextareas);

        // File Input Change Listener
        fileInput.addEventListener('change', (e) => {
            processFiles(e.target.files);
        });

        // Drag and Drop Listeners
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('border-accent-green'); // Keep visual feedback for dragover
            dropArea.style.transform = 'scale(1.02)'; // Slight scale on hover
        });

        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('border-accent-green');
            dropArea.style.transform = 'scale(1)'; // Reset scale
        });

        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('border-accent-green');
            dropArea.style.transform = 'scale(1)'; // Reset scale
            processFiles(e.dataTransfer.files);
        });

        // Allow clicking the drop area to open file dialog
        dropArea.addEventListener('click', () => {
            fileInput.click();
        });

        // Initial beautify if there's pre-filled content (e.g., from browser restore)
        if (jsonInput.value.trim()) {
            beautifyJson();
        }
    </script>
</body>
</html>
